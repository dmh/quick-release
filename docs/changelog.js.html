<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: changelog.js</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link type="text/css" rel="stylesheet" href="styles/base.min.css">
</head>

<body class="body">

    <div class="container">

        <nav class="sidenav">
            <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="CHANGELOG.html">CHANGELOG</a></li><li><a href="CHECK.html">CHECK</a></li><li><a href="COMMANDS.html">COMMANDS</a></li><li><a href="CONFIG.html">CONFIG</a></li><li><a href="GIT.html">GIT</a></li><li><a href="GITHUB.html">GITHUB</a></li><li><a href="PROMPTS.html">PROMPTS</a></li><li><a href="UTILS.html">UTILS</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectLocalData">collectLocalData</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#parseArgs">parseArgs</a></li></ul>
        </nav>

        <main id="main" class="main">
            <div id="content" class="content">
                <h1 class="page-title">Source: changelog.js</h1>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as TYPES from '#types/types.js' // eslint-disable-line
import fsPromises from 'node:fs/promises'
import path from 'node:path'
import { splitLogToGenericAndBreaking, filterGenericCommits } from '#utils/parse.js'

/**
* @ignore
* @typedef {TYPES.DATA} DATA {@link DATA}
* @typedef {TYPES.COMMIT_MESSAGE} COMMIT_MESSAGE {@link COMMIT_MESSAGE}
*/

/**
 * #### return current date in Month Day, Year format
 * @private
 * @memberof CHANGELOG
 * @returns {string} date
 */
function dateNow () {
  const date = new Date()
  const month = date.toLocaleString('default', { month: 'long' })
  const day = date.getDate()
  const year = date.getFullYear()
  return `${month} ${day}, ${year}`
}

/**
 * #### parse git logs and return commits as a changelog object
 * @memberof CHANGELOG
 * @param {DATA} data - data object
 * @returns undefined
 */
function saveChangelogData (data) {
  data.changelog = { ...data.changelog, ...splitLogToGenericAndBreaking(data.git.log, data.config.changelog.breakingLabel) }
  data.changelog.generic = filterGenericCommits(data.changelog.generic, data.config.changelog.labels)
}

/**
 * #### format changelog data draft
 * @memberof CHANGELOG
 * @param {DATA} data - data object
 * @returns undefined
 */
function saveChangelogDraft (data) {
  const title = `### v${data.answers.releaseVersion} \`${dateNow()}\`\n`
  let changelog = ''
  let breaking = ''
  const end = '***\n\n'
  const hashUrl = (/** @type {string} */ hash) => {
    if (
      data.answers.releaseType === 'remote' &amp;&amp;
      data.git.remote.full_name &amp;&amp;
      data.git.remote.host
    ) {
      return ` [\`${hash}\`](https://${data.git.remote.host}/${data.git.remote.full_name}/commit/${hash})`
    } else {
      return ` \`${hash}\``
    }
  }
  const prefix = (/** @type {string} */ prefix) => {
    return prefix !== '' ? `**${prefix}** ` : ''
  }
  const name = (/** @type {string} */ name) => {
    return name !== '' ? ` (${name})` : ''
  }

  if (data.changelog.generic.length > 0) {
    data.changelog.generic.forEach((/** @type {any} */ item) => {
      changelog += `* ${prefix(item.prefix)}${item.message}${hashUrl(item.hash)}${name(item.name)}\n`
    })
  }
  if (data.changelog.breaking.length > 0) {
    data.changelog.breaking.forEach((/** @type {any} */ item) => {
      breaking += `* ${prefix(item.prefix)}${item.message}${hashUrl(item.hash)}${name(item.name)}\n`
    })
  }
  if (changelog !== '') {
    changelog = `${changelog}\n`
  }
  if (breaking !== '') {
    breaking = `#### Breaking Changes\n${breaking}\n`
  }
  data.changelog.draft = title + changelog + breaking + end
}

/**
 * #### write changelog draft data to file
 * @async
 * @memberof CHANGELOG
 * @param {DATA} data - data object
 * @returns undefined
 */
async function changelogWriteFile (data) {
  const filePath = path.resolve('.', data.config.changelog.file)
  if (data.changelog.draft) {
    try {
      const oldChangelog = await fsPromises.readFile(filePath)
      await fsPromises.writeFile(filePath, data.changelog.draft, { encoding: 'utf8' })
      await fsPromises.appendFile(filePath, oldChangelog, { encoding: 'utf8' })
    } catch (error) {
      console.error(error)
    }
  }
}

export { saveChangelogData, saveChangelogDraft, changelogWriteFile }
</code></pre>
        </article>
    </section>




            </div>

            <div class="toc">
                <h2>Table of contents</h2>
                <div class="toc-nav"></div>
            </div>
        </main>

        <footer class="footer">
            Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a>
        </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    <script >
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('.prettyprint.linenums code').forEach((el) => {
                hljs.configure({
                    languages: ['javascript'],
                });
                hljs.highlightElement(el);
                hljs.lineNumbersBlock(el);
            });
            document.querySelectorAll('pre code').forEach((el) => {
                hljs.configure({
                    languages: ['javascript'],
                });
                hljs.highlightElement(el);
            });
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
    <script>
        tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.toc-nav',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.main article',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1.name, h2.name, h3.name, h4.name',
        headingLabelCallback: (string) => string
    });
    </script>
</body>
</html>
